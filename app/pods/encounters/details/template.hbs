{{#liquid-bind model use='offset-fade' class='liquid-main' enableGrowth=false as |currentModel|}}
  {{#unless currentModel.encounter.isNew}}
    <header class="constrained">
      <h1>{{currentModel.encounter.name}}</h1>
      <span class="spacer"></span>
      <button class="button danger" {{action (toggle-action 'showDeleteConfirmationModal' this)}}>Delete</button>
      {{list-popover label='Add PC' currentModel=currentModel.playerCharacters onSelect=(route-action 'addPC')}}
      {{list-popover label='Add Monster' currentModel=currentModel.monsters onSelect=(route-action 'addMonster')}}
    </header>
    {{list-combatants class='constrained'
      combatants=currentModel.encounter.arrangedCombatants
      onDelete=(action (mut showDeleteConfirmationModalFor))
      onUpdate=(route-action 'saveParticipant')
      onSetTurn=(route-action 'setTurn')
      onShowNotes=(action (mut showNotesFor))}}
  {{/unless}}

  {{#ember-wormhole to='modal'}}
    {{#x-modal class=(if showNameModal 'shown' 'hidden')}}
      <form class="traditional modal" {{action (route-action 'create') on='submit'}}>
        <p>
          {{input id='name' value=name}}
          <label for="name" class="wordy">Name this new encounter:</label>
        </p>
        <p class="actions">
          {{#link-to 'encounters' classNames='button subtle'}}Cancel{{/link-to}}
          <button type="submit" class="button primary">Create</button>
        </p>
      </form>
    {{/x-modal}}
    {{#x-modal class=(if showDeleteConfirmationModal 'shown' 'hidden')}}
      <form class="traditional modal">
        <p>
          <label class="wordy">Are you sure you want to delete this encounter?</label>
        </p>
        <p class="actions">
          <button type="button" class="button subtle" {{action (toggle-action 'showDeleteConfirmationModal' this)}}>No</button>
          <button type="submit" class="button danger" {{action (route-action 'delete' currentModel.encounter)}}>Yes</button>
        </p>
      </form>
    {{/x-modal}}
    {{#x-modal class=(if showDeleteConfirmationModalFor 'shown' 'hidden')}}
      <form class="traditional modal">
        <p>
          <label class="wordy">Are you sure you want to delete “{{showDeleteConfirmationModalFor.name}}”?</label>
        </p>
        <p class="actions">
          <button type="button" class="button subtle" {{action (action (mut showDeleteConfirmationModalFor null))}}>No</button>
          <button type="submit" class="button danger" {{action (route-action 'deleteCombatant' showDeleteConfirmationModalFor)}}>Yes</button>
        </p>
      </form>
    {{/x-modal}}
    {{#x-modal class=(if showNotesFor 'shown' 'hidden')}}
      <form class="traditional modal">
        <p class="h3">{{showNotesFor.name}}’s Notes</p>
        <p>{{showNotesFor.notes}}</p>
        <p class="actions">
          <button type="button" class="button subtle" {{action (action (mut showNotesFor null))}}>Close</button>
        </p>
      </form>
    {{/x-modal}}
  {{/ember-wormhole}}
{{/liquid-bind}}
